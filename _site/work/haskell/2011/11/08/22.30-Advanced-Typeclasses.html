<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Advanced Typeclasses</title>
        <meta name="description" content="Rodney's Blog">
        <meta name="author" content="Rodney Gomes">

        <link rel="alternate"
              type="application/rss+xml"
              title="Rodney's Corner RSS Feed"
              href="http://feeds.feedburner.com/rlgomesgithubcom/feed"/>

        <link href="/css/bootstrap.css" rel="stylesheet">
        <link href="/css/main.css" rel="stylesheet"/>
    </head>
    <body>

    <div class="topbar">
      <div class="fill">
        <div class="container">
          <a class="brand" href="/">Rodney's Corner</a>
          <ul class="nav">
            <li class="active"><a href="/">Blog</a></li>
            <li><a href="/archive.html">Archive</a></li>
            <li><a href="/about.html">About</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="content">
        <div class="page-header">
          <h1>Advanced Typeclasses</h1>
        </div>
        <div class="row">
          <div class="span10">
             <article>
                   <div id="post.body"><p>Lets go back a bit to the typeclass topic and analye and understand well a few important typeclasses that allow you to do a few intesting things. We&#8217;ll start with the <strong>Functor</strong> typeclass, which has the following definition:</p>
<div class='highlight'><pre><code class='hs'><span class='kr'>class</span> <span class='kt'>Functor</span> <span class='n'>f</span> <span class='kr'>where</span>
    <span class='n'>fmap</span> <span class='ow'>::</span> <span class='p'>(</span><span class='n'>a</span> <span class='ow'>-&gt;</span> <span class='n'>b</span><span class='p'>)</span> <span class='ow'>-&gt;</span> <span class='n'>f</span> <span class='n'>a</span> <span class='ow'>-&gt;</span> <span class='n'>f</span> <span class='n'>b</span>
</code></pre>
</div>
<p>We&#8217;ve introduced a new notation in our signature with the <strong>f a</strong>, in this simple signature we&#8217;re using the a generic type constructor reference instead of a concrete constructor such as <strong>Maybe</strong> or from our previous post <strong>Tree</strong>. So when we create an instance of a <strong>Functor f</strong> we basically letting any function that wants to use the <strong>Functor</strong> how to apply and reconstruct our type. We can see how to easily implement a <strong>Functor</strong> instance for lists, like so:</p>
<div class='highlight'><pre><code class='hs'><span class='kr'>instance</span> <span class='kt'>Functor</span> <span class='kt'>[]</span> <span class='kr'>where</span>
    <span class='n'>fmap</span> <span class='ow'>=</span> <span class='n'>map</span>
</code></pre>
</div>
<p>Lets define the instance of <strong>Functor</strong> for the <strong>Tree</strong> data type we defined in the previous post:</p>
<div class='highlight'><pre><code class='hs'><span class='kr'>instance</span> <span class='kt'>Functor</span> <span class='kt'>Tree</span> <span class='n'>a</span> <span class='kr'>where</span>
    <span class='n'>fmap</span> <span class='kr'>_</span> <span class='kt'>Leaf</span> <span class='ow'>=</span> <span class='kt'>Leaf</span>
    <span class='n'>fmap</span> <span class='n'>f</span> <span class='p'>(</span><span class='kt'>Node</span> <span class='n'>a</span> <span class='n'>l</span> <span class='n'>r</span><span class='p'>)</span> <span class='ow'>=</span> <span class='kt'>Node</span> <span class='p'>(</span><span class='n'>f</span> <span class='n'>a</span><span class='p'>)</span> <span class='p'>(</span><span class='n'>fmap</span> <span class='n'>f</span> <span class='n'>l</span><span class='p'>)</span> <span class='p'>(</span><span class='n'>fmap</span> <span class='n'>f</span> <span class='n'>r</span><span class='p'>)</span>
</code></pre>
</div>
<p>With the above we can now easily apply higher order functions to our <strong>Tree</strong> instances like so:</p>
<console>
Main> fmap (+2) sampleTree
3
    4
        .
        .
    5
        6
            .
            .
        .
</console>
<p>This is where I believe you should really start to see the beauty in the way that Haskell works with your data types and being able to easily modify, transform your types. There are a few other classtypes to look at which include <strong>Foldable</strong>, <strong>Traversable</strong>, etc.</p>

<p>We&#8217;re now going to have a look at the <strong>Show</strong> and <strong>Read</strong> classtypes. We&#8217;ve already seen the <strong>Show</strong> classtype but we want to show the complete function here and understand a bit better how this works with the <strong>Read</strong> classtype. So here&#8217;s the full definition of the Show classtype:</p>
<div class='highlight'><pre><code class='hs'><span class='kr'>class</span>  <span class='kt'>Show</span> <span class='n'>a</span>  <span class='kr'>where</span>
    <span class='n'>showsPrec</span>        <span class='ow'>::</span> <span class='kt'>Int</span> <span class='ow'>-&gt;</span> <span class='n'>a</span> <span class='ow'>-&gt;</span> <span class='kt'>ShowS</span>
    <span class='n'>show</span>       <span class='ow'>::</span> <span class='n'>a</span> <span class='ow'>-&gt;</span> <span class='kt'>String</span>
    <span class='n'>showList</span>         <span class='ow'>::</span> <span class='p'>[</span><span class='n'>a</span><span class='p'>]</span> <span class='ow'>-&gt;</span> <span class='kt'>ShowS</span>

<span class='c1'>-- Mimimal complete definition:</span>
<span class='c1'>-- show or showsPrec</span>
    <span class='n'>showsPrec</span> <span class='kr'>_</span> <span class='n'>x</span> <span class='n'>s</span>   <span class='ow'>=</span> <span class='n'>show</span> <span class='n'>x</span> <span class='o'>++</span> <span class='n'>s</span>

    <span class='n'>show</span> <span class='n'>x</span>        <span class='ow'>=</span> <span class='n'>showsPrec</span> <span class='mi'>0</span> <span class='n'>x</span> <span class='s'>&quot;&quot;</span>

    <span class='n'>showList</span> <span class='kt'>[]</span>       <span class='ow'>=</span> <span class='n'>showString</span> <span class='s'>&quot;[]&quot;</span>
    <span class='n'>showList</span> <span class='p'>(</span><span class='n'>x</span><span class='kt'>:</span><span class='n'>xs</span><span class='p'>)</span>   <span class='ow'>=</span> <span class='n'>showChar</span> <span class='sc'>&#39;[&#39;</span> <span class='o'>.</span> <span class='n'>shows</span> <span class='n'>x</span> <span class='o'>.</span> <span class='n'>showl</span> <span class='n'>xs</span>
                        <span class='kr'>where</span> <span class='n'>showl</span> <span class='kt'>[]</span>     <span class='ow'>=</span> <span class='n'>showChar</span> <span class='sc'>&#39;]&#39;</span>
                              <span class='n'>showl</span> <span class='p'>(</span><span class='n'>x</span><span class='kt'>:</span><span class='n'>xs</span><span class='p'>)</span> <span class='ow'>=</span> <span class='n'>showChar</span> <span class='sc'>&#39;,&#39;</span> <span class='o'>.</span> <span class='n'>shows</span> <span class='n'>x</span> <span class='o'>.</span>
                                             <span class='n'>showl</span> <span class='n'>xs</span>
</code></pre>
</div>
<p>As we did before we only have to implement the <strong>show</strong> function (don&#8217;t want to get into the <strong>showsPrec</strong> function at this stage). We&#8217;ll create a new binary tree data type and define a very simple <strong>Show</strong> instance for this, here&#8217;s what we&#8217;re looking at:</p>
<div class='highlight'><pre><code class='hs'><span class='kr'>data</span> <span class='kt'>BTree</span> <span class='n'>a</span> <span class='ow'>=</span> <span class='kt'>Leaf</span> <span class='n'>a</span> <span class='o'>|</span> <span class='kt'>Branch</span> <span class='p'>(</span><span class='kt'>BTree</span> <span class='n'>a</span><span class='p'>)</span> <span class='p'>(</span><span class='kt'>BTree</span> <span class='n'>a</span><span class='p'>)</span>

<span class='nf'>showBTree</span> <span class='ow'>::</span> <span class='p'>(</span><span class='kt'>Show</span> <span class='n'>a</span><span class='p'>)</span> <span class='ow'>=&gt;</span> <span class='kt'>BTree</span> <span class='n'>a</span> <span class='ow'>-&gt;</span> <span class='kt'>String</span>
<span class='nf'>showBTree</span> <span class='p'>(</span><span class='kt'>Leaf</span> <span class='n'>a</span><span class='p'>)</span> <span class='ow'>=</span> <span class='n'>show</span> <span class='n'>a</span>
<span class='nf'>showBTree</span> <span class='p'>(</span><span class='kt'>Branch</span> <span class='n'>l</span> <span class='n'>r</span><span class='p'>)</span> <span class='ow'>=</span> <span class='s'>&quot;(&quot;</span> <span class='o'>++</span> <span class='n'>showBTree</span> <span class='n'>l</span> <span class='o'>++</span> <span class='s'>&quot;|&quot;</span> <span class='o'>++</span> <span class='n'>showBTree</span> <span class='n'>r</span> <span class='o'>++</span> <span class='s'>&quot;)&quot;</span>

<span class='kr'>instance</span> <span class='kt'>Show</span> <span class='n'>a</span> <span class='ow'>=&gt;</span> <span class='kt'>Show</span> <span class='p'>(</span><span class='kt'>BTree</span> <span class='n'>a</span><span class='p'>)</span> <span class='kr'>where</span>
    <span class='n'>show</span> <span class='n'>a</span> <span class='ow'>=</span> <span class='n'>showBTree</span> <span class='n'>a</span>

<span class='nf'>sampleTree</span> <span class='ow'>=</span> <span class='kt'>Branch</span> <span class='p'>(</span><span class='kt'>Branch</span> <span class='p'>(</span><span class='kt'>Leaf</span> <span class='mi'>3</span><span class='p'>)</span> <span class='p'>(</span><span class='kt'>Leaf</span> <span class='mi'>2</span><span class='p'>))</span> <span class='p'>(</span><span class='kt'>Leaf</span> <span class='mi'>1</span><span class='p'>)</span>
</code></pre>
</div>
<p>So when we do a show of the sampleTree we get the following output:</p>
<console>
((3|2)|1)
</console>
<p>Now we have to read the <strong>Read</strong> instance so that we can easily parse the expressions of a <strong>BTree</strong> back into a <strong>BTree</strong> type that we can then process with the various functions that&#8217;ll we&#8217;ll eventually write. The <strong>Read</strong> class iself has the following definition:</p>
<div class='highlight'><pre><code class='hs'><span class='kr'>class</span>  <span class='kt'>Read</span> <span class='n'>a</span>  <span class='kr'>where</span>
    <span class='n'>readsPrec</span>        <span class='ow'>::</span> <span class='kt'>Int</span> <span class='ow'>-&gt;</span> <span class='kt'>ReadS</span> <span class='n'>a</span>
    <span class='n'>readList</span>         <span class='ow'>::</span> <span class='kt'>ReadS</span> <span class='p'>[</span><span class='n'>a</span><span class='p'>]</span>

<span class='c1'>-- Minimal complete definition:</span>
<span class='c1'>-- readsPrec</span>
    <span class='n'>readList</span>         <span class='ow'>=</span> <span class='n'>readParen</span> <span class='kt'>False</span> <span class='p'>(</span><span class='nf'>\</span><span class='n'>r</span> <span class='ow'>-&gt;</span> <span class='p'>[</span><span class='n'>pr</span> <span class='o'>|</span> <span class='p'>(</span><span class='s'>&quot;[&quot;</span><span class='p'>,</span><span class='n'>s</span><span class='p'>)</span>  <span class='ow'>&lt;-</span> <span class='n'>lex</span> <span class='n'>r</span><span class='p'>,</span>
                                                    <span class='n'>pr</span>       <span class='ow'>&lt;-</span> <span class='n'>readl</span> <span class='n'>s</span><span class='p'>])</span>
                       <span class='kr'>where</span> <span class='n'>readl</span>  <span class='n'>s</span> <span class='ow'>=</span> <span class='p'>[(</span><span class='kt'>[]</span><span class='p'>,</span><span class='n'>t</span><span class='p'>)</span>   <span class='o'>|</span> <span class='p'>(</span><span class='s'>&quot;]&quot;</span><span class='p'>,</span><span class='n'>t</span><span class='p'>)</span>  <span class='ow'>&lt;-</span> <span class='n'>lex</span> <span class='n'>s</span><span class='p'>]</span> <span class='o'>++</span>
                                        <span class='p'>[(</span><span class='n'>x</span><span class='kt'>:</span><span class='n'>xs</span><span class='p'>,</span><span class='n'>u</span><span class='p'>)</span> <span class='o'>|</span> <span class='p'>(</span><span class='n'>x</span><span class='p'>,</span><span class='n'>t</span><span class='p'>)</span>    <span class='ow'>&lt;-</span> <span class='n'>reads</span> <span class='n'>s</span><span class='p'>,</span>
                                                    <span class='p'>(</span><span class='n'>xs</span><span class='p'>,</span><span class='n'>u</span><span class='p'>)</span>   <span class='ow'>&lt;-</span> <span class='n'>readl&#39;</span> <span class='n'>t</span><span class='p'>]</span>
                             <span class='n'>readl&#39;</span> <span class='n'>s</span> <span class='ow'>=</span> <span class='p'>[(</span><span class='kt'>[]</span><span class='p'>,</span><span class='n'>t</span><span class='p'>)</span>   <span class='o'>|</span> <span class='p'>(</span><span class='s'>&quot;]&quot;</span><span class='p'>,</span><span class='n'>t</span><span class='p'>)</span>  <span class='ow'>&lt;-</span> <span class='n'>lex</span> <span class='n'>s</span><span class='p'>]</span> <span class='o'>++</span>
                                        <span class='p'>[(</span><span class='n'>x</span><span class='kt'>:</span><span class='n'>xs</span><span class='p'>,</span><span class='n'>v</span><span class='p'>)</span> <span class='o'>|</span> <span class='p'>(</span><span class='s'>&quot;,&quot;</span><span class='p'>,</span><span class='n'>t</span><span class='p'>)</span>  <span class='ow'>&lt;-</span> <span class='n'>lex</span> <span class='n'>s</span><span class='p'>,</span>
                                                    <span class='p'>(</span><span class='n'>x</span><span class='p'>,</span><span class='n'>u</span><span class='p'>)</span>    <span class='ow'>&lt;-</span> <span class='n'>reads</span> <span class='n'>t</span><span class='p'>,</span>
                                                    <span class='p'>(</span><span class='n'>xs</span><span class='p'>,</span><span class='n'>v</span><span class='p'>)</span>   <span class='ow'>&lt;-</span> <span class='n'>readl&#39;</span> <span class='n'>u</span><span class='p'>]</span>
</code></pre>
</div>
<p>As before we only need to implement the readsPrec function to have a working <strong>Read</strong> implementation. So lets also have a look at the <strong>ReadS</strong> type:</p>
<div class='highlight'><pre><code class='hs'><span class='kr'>type</span> <span class='kt'>ReadS</span> <span class='n'>a</span> <span class='ow'>=</span> <span class='kt'>String</span> <span class='ow'>-&gt;</span> <span class='p'>[(</span><span class='n'>a</span><span class='p'>,</span> <span class='kt'>String</span><span class='p'>)]</span>
</code></pre>
</div>
<p>This type defines what a parse does which is to return for parts of the original string with the accompanying converted type. It also allows you to parse whatever is part of your <strong>Read</strong> implementation and return the rest of the string that wasn&#8217;t parsed.</p>

<p>Before we implement the <strong>Read</strong> instance for <strong>BTree</strong>s lets talk about list comprehension and how to use it. List comprenhension is another feature in Haskell that is implemented quite elegantly. List comprenhension has the following syntax:</p>
<console>
[ expr | qualifier0 , ... , qualifierN ]
</console>
<p>In which the expr defines the way the elements are composed within the list being generated and the qualifiers identify which elements are to be in the resulting list. So lets for example construct a list of all of the odd numbers from 1 to 100:</p>
<div class='highlight'><pre><code class='hs'><span class='nf'>odd100</span> <span class='ow'>=</span> <span class='p'>[</span> <span class='n'>i</span> <span class='o'>|</span> <span class='n'>i</span> <span class='ow'>&lt;-</span> <span class='p'>[</span><span class='mi'>1</span><span class='o'>..</span><span class='mi'>100</span><span class='p'>],</span> <span class='n'>odd</span><span class='p'>(</span><span class='n'>i</span><span class='p'>)</span> <span class='p'>]</span>
</code></pre>
</div>
<p>Now here&#8217;s how we could start putting together out <strong>readTree</strong> function:</p>
<div class='highlight'><pre><code class='hs'><span class='nf'>readsTree</span> <span class='ow'>::</span> <span class='p'>(</span><span class='kt'>Read</span> <span class='n'>a</span><span class='p'>)</span> <span class='ow'>=&gt;</span> <span class='kt'>ReadS</span> <span class='p'>(</span><span class='kt'>BTree</span> <span class='n'>a</span><span class='p'>)</span>
<span class='nf'>readsTree</span> <span class='p'>(</span><span class='sc'>&#39;(&#39;</span><span class='kt'>:</span><span class='n'>s</span><span class='p'>)</span> <span class='ow'>=</span> <span class='p'>[</span> <span class='p'>(</span><span class='kt'>Branch</span> <span class='n'>l</span> <span class='n'>r</span><span class='p'>,</span> <span class='n'>u</span><span class='p'>)</span> <span class='o'>|</span> <span class='p'>(</span><span class='n'>l</span><span class='p'>,</span> <span class='sc'>&#39;|&#39;</span><span class='kt'>:</span><span class='n'>t</span><span class='p'>)</span> <span class='ow'>&lt;-</span> <span class='n'>readsTree</span> <span class='n'>s</span><span class='p'>,</span>
                                        <span class='p'>(</span><span class='n'>r</span><span class='p'>,</span> <span class='sc'>&#39;)&#39;</span><span class='kt'>:</span><span class='n'>u</span><span class='p'>)</span> <span class='ow'>&lt;-</span> <span class='n'>readsTree</span> <span class='n'>t</span> <span class='p'>]</span>
<span class='nf'>readsTree</span> <span class='n'>s</span> <span class='ow'>=</span> <span class='p'>[(</span><span class='kt'>Leaf</span> <span class='n'>x</span><span class='p'>,</span> <span class='n'>t</span><span class='p'>)</span>  <span class='o'>|</span> <span class='p'>(</span><span class='n'>x</span><span class='p'>,</span><span class='n'>t</span><span class='p'>)</span> <span class='ow'>&lt;-</span> <span class='n'>reads</span> <span class='n'>s</span><span class='p'>]</span>

<span class='kr'>instance</span> <span class='kt'>Read</span> <span class='n'>a</span> <span class='ow'>=&gt;</span> <span class='kt'>Read</span> <span class='p'>(</span><span class='kt'>BTree</span> <span class='n'>a</span><span class='p'>)</span> <span class='kr'>where</span>
    <span class='n'>readsPrec</span> <span class='kr'>_</span> <span class='n'>s</span> <span class='ow'>=</span> <span class='n'>readsBTree</span> <span class='n'>s</span>
</code></pre>
</div>
<p>Now the above function can be a bit to take in all at once but if you have a closer look its really not doing much more than stating that if a string starts with the <strong>&#8217;(&#8217;</strong> symbol then a <strong>Branch l r</strong> can be parsed from this string in which the <strong>l</strong> comes from <strong>readSTree s</strong> and the returned string must start with the <strong>&#8217;|&#8217;</strong> and then continues with <strong>t</strong> which would be parsed to return the <strong>r</strong> side of the <strong>Branch</strong> and would leave you with at least the <strong>&#8217;)&#8217;</strong> symbol followed by the rest of the string (which may be empty). The last pattern of the function assumes everything else would be a <strong>Leaf x</strong> where is comes from <strong>reads</strong> of <strong>s</strong>.</p>

<p>This can now be easily be used to parse string back into the <strong>BTree</strong> type, like so:</p>
<console>
Main> (reads "(1|(2|3))blah")::[(BTree Int,String)]
[((1|(2|3)),"blah")]
</console>
<p>We do have to tell <strong>Haskell</strong> what the type of the return is because otherwise Haskell can&#8217;t deduce if its a binary tree of integers or a binary tree of strings.</p>

<p>By now I would hope you&#8217;d be able to write <strong>Read</strong> and <strong>Show</strong> instances for any of your own new datatypes and be able to have Haskell really work for you.</p></div>
             </article>
             <hr/>
             <div id="disqus_thread"></div>
             <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'rodneyscorner'; // required: replace example with your forum shortname

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
              </script>
              <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
          <div class="span4">
            
                <h2>Related Posts</h2>
                <ul>
                    
                    <li><a href="/work/haskell/2011/11/14/20.30-Optimizing-Haskell-Programs.html">Optimizing Haskell Programs</a></li>
                    
                    <li><a href="/work/haskell/2011/11/13/13.00-Writing-wc-command-line-tool-in-Haskell.html">Writing wc command line tool in Haskell</a></li>
                    
                    <li><a href="/work/haskell/2011/11/01/23.00-Higher-order-functions-in-Haskell.html">Higher order functions in Haskell</a></li>
                    
                    <li><a href="/work/haskell/2011/10/31/20.00-Custom-data-types-in-Haskell.html">Custom data types in Haskell</a></li>
                    
                    <li><a href="/work/haskell/2011/10/30/20.00-haskell-basics.html">Haskell Basics</a></li>
                    
                </ul>
            
          </div>
        </div>
      </div>
      <footer>
        <div style="text-align: right">Powered by <a href="http://jekyllrb.com/">Jekyll</a> &amp; <a href="http://twitter.github.com/bootstrap/index.html">Bootstrap</a></div>
        <div style="text-align: right">Last Updated: Wed May 16 16:16:15 -0700 2012</div>
      </footer>
    </div> <!-- /container -->
</html>
